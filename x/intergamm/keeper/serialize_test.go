// TODO do not merge me, should only be used for testing/debugging

package keeper

import (
	"fmt"
	"testing"

	"github.com/cosmos/cosmos-sdk/simapp"
	sdk "github.com/cosmos/cosmos-sdk/types"
	icatypes "github.com/cosmos/ibc-go/v3/modules/apps/27-interchain-accounts/types"
	gammtypes "github.com/quasarlabs/quasarnode/osmosis/gamm/types"
	"github.com/stretchr/testify/assert"
)

func TestDeserializeTX(t *testing.T) {
	var data icatypes.InterchainAccountPacketData

	tx := []byte{123,34,116,121,112,101,34,58,34,84,89,80,69,95,69,88,69,67,85,84,69,95,84,88,34,44,34,100,97,116,97,34,58,91,49,48,44,49,55,54,44,49,44,49,48,44,51,53,44,52,55,44,57,57,44,49,49,49,44,49,49,53,44,49,48,57,44,49,49,49,44,49,49,53,44,52,54,44,49,49,53,44,49,49,54,44,57,55,44,49,48,55,44,49,48,53,44,49,49,48,44,49,48,51,44,52,54,44,49,49,56,44,52,57,44,57,56,44,49,48,49,44,49,49,54,44,57,55,44,52,57,44,52,54,44,55,55,44,49,49,53,44,49,48,51,44,54,56,44,49,48,49,44,49,48,56,44,49,48,49,44,49,48,51,44,57,55,44,49,49,54,44,49,48,49,44,49,56,44,49,51,54,44,49,44,49,48,44,54,53,44,57,57,44,49,49,49,44,49,49,53,44,49,48,57,44,49,49,49,44,49,49,53,44,52,57,44,53,51,44,57,57,44,57,57,44,49,49,53,44,49,48,52,44,49,48,52,44,49,48,57,44,49,49,50,44,52,56,44,49,48,51,44,49,49,53,44,49,50,48,44,53,48,44,53,55,44,49,49,51,44,49,49,50,44,49,49,51,44,49,49,51,44,53,52,44,49,48,51,44,53,50,44,49,50,50,44,49,48,57,44,49,48,56,44,49,49,54,44,49,49,48,44,49,49,48,44,49,49,56,44,49,48,51,44,49,48,57,44,49,50,49,44,49,49,55,44,53,55,44,49,49,55,44,49,48,49,44,49,49,55,44,57,55,44,49,48,48,44,49,48,52,44,53,55,44,49,50,49,44,53,48,44,49,49,48,44,57,57,44,53,51,44,49,50,50,44,49,48,54,44,52,56,44,49,49,53,44,49,50,50,44,49,48,56,44,49,49,53,44,53,51,44,49,48,51,44,49,49,54,44,49,48,48,44,49,48,48,44,49,50,50,44,49,56,44,53,50,44,57,57,44,49,49,49,44,49,49,53,44,49,48,57,44,49,49,49,44,49,49,53,44,49,49,56,44,57,55,44,49,48,56,44,49,49,49,44,49,49,50,44,49,48,49,44,49,49,52,44,52,57,44,49,49,51,44,49,49,48,44,49,48,55,44,53,48,44,49,49,48,44,53,50,44,49,49,48,44,49,48,56,44,49,48,55,44,49,49,50,44,49,49,57,44,53,55,44,49,50,48,44,49,48,50,44,49,49,51,44,49,49,48,44,49,49,54,44,49,48,56,44,57,55,44,49,48,48,44,49,48,52,44,53,53,44,53,50,44,49,49,57,44,53,52,44,49,49,55,44,49,48,54,44,49,49,54,44,49,49,55,44,49,48,56,44,49,49,57,44,49,49,48,44,49,48,57,44,49,50,48,44,49,49,48,44,49,48,52,44,53,49,44,49,48,55,44,50,54,44,49,51,44,49,48,44,53,44,49,49,53,44,49,49,54,44,57,55,44,49,48,55,44,49,48,49,44,49,56,44,52,44,52,57,44,52,56,44,52,56,44,52,56,93,44,34,109,101,109,111,34,58,34,34,125}
	appCodec := simapp.MakeTestEncodingConfig()
	err := appCodec.Marshaler.UnmarshalJSON(tx, &data)

	assert.NoError(t, err)
	fmt.Println(data)
}

func TestSerializeTx(t *testing.T) {

	appCodec := simapp.MakeTestEncodingConfig().Marshaler


	msgs := []sdk.Msg{
		&gammtypes.MsgJoinSwapExternAmountIn{
			Sender:            "counter_party_address",
			PoolId:            1,
			TokenIn:           sdk.Coin{
				Denom:  "uqsr",
				Amount: sdk.NewInt(1000),
			},
			ShareOutMinAmount: sdk.OneInt(),
		},
	}

	data, err := icatypes.SerializeCosmosTx(appCodec, msgs)
	assert.NoError(t, err)


	packet := icatypes.InterchainAccountPacketData{
		Type: icatypes.EXECUTE_TX,
		Data: data,
	}

	packetData := packet.GetBytes()
	fmt.Printf("%v", data)
	fmt.Printf("%v\n", packetData)
	fmt.Println(string(packetData))
}