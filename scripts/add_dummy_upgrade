#!/usr/bin/env bash

set -Cue -o pipefail

# this contains a git patch of a dummy quasar chain upgrade, for testing purposes
load_patch() {
  base64 -d << EOS
ZGlmZiAtLWdpdCBhL2FwcC91cGdyYWRlcy9kdW1teS9jb25zdGFudHMuZ28gYi9hcHAvdXBncmFk
ZXMvZHVtbXkvY29uc3RhbnRzLmdvCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAu
LjZjODM0YmUKLS0tIC9kZXYvbnVsbAorKysgYi9hcHAvdXBncmFkZXMvZHVtbXkvY29uc3RhbnRz
LmdvCkBAIC0wLDAgKzEsMTYgQEAKK3BhY2thZ2UgdjIKKworaW1wb3J0ICgKKwkiZ2l0aHViLmNv
bS9hYmFnL3F1YXNhcm5vZGUvYXBwL3VwZ3JhZGVzIgorCisJc3RvcmUgImdpdGh1Yi5jb20vY29z
bW9zL2Nvc21vcy1zZGsvc3RvcmUvdHlwZXMiCispCisKKy8vIFVwZ3JhZGVOYW1lIGRlZmluZXMg
dGhlIG9uLWNoYWluIHVwZ3JhZGUgbmFtZSBmb3IgdGhlIGR1bW15IHVwZ3JhZGUuCitjb25zdCBV
cGdyYWRlTmFtZSA9ICJkdW1teSIKKwordmFyIFVwZ3JhZGUgPSB1cGdyYWRlcy5VcGdyYWRlewor
CVVwZ3JhZGVOYW1lOiAgICAgICAgICBVcGdyYWRlTmFtZSwKKwlDcmVhdGVVcGdyYWRlSGFuZGxl
cjogQ3JlYXRlVXBncmFkZUhhbmRsZXIsCisJU3RvcmVVcGdyYWRlczogICAgICAgIHN0b3JlLlN0
b3JlVXBncmFkZXN7fSwKK30KZGlmZiAtLWdpdCBhL2FwcC91cGdyYWRlcy9kdW1teS91cGdyYWRl
cy5nbyBiL2FwcC91cGdyYWRlcy9kdW1teS91cGdyYWRlcy5nbwpuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwLi5iOWZiZmJjCi0tLSAvZGV2L251bGwKKysrIGIvYXBwL3VwZ3JhZGVz
L2R1bW15L3VwZ3JhZGVzLmdvCkBAIC0wLDAgKzEsMjQgQEAKK3BhY2thZ2UgdjIKKworaW1wb3J0
ICgKKwkiZm10IgorCisJImdpdGh1Yi5jb20vYWJhZy9xdWFzYXJub2RlL2FwcC91cGdyYWRlcyIK
KwlzZGsgImdpdGh1Yi5jb20vY29zbW9zL2Nvc21vcy1zZGsvdHlwZXMiCisJImdpdGh1Yi5jb20v
Y29zbW9zL2Nvc21vcy1zZGsvdHlwZXMvbW9kdWxlIgorCXVwZ3JhZGV0eXBlcyAiZ2l0aHViLmNv
bS9jb3Ntb3MvY29zbW9zLXNkay94L3VwZ3JhZGUvdHlwZXMiCispCisKK2Z1bmMgQ3JlYXRlVXBn
cmFkZUhhbmRsZXIoCisJbW0gKm1vZHVsZS5NYW5hZ2VyLAorCWNvbmZpZ3VyYXRvciBtb2R1bGUu
Q29uZmlndXJhdG9yLAorCV8gdXBncmFkZXMuQmFzZUFwcFBhcmFtTWFuYWdlciwKKykgdXBncmFk
ZXR5cGVzLlVwZ3JhZGVIYW5kbGVyIHsKKwlyZXR1cm4gZnVuYyhjdHggc2RrLkNvbnRleHQsIHBs
YW4gdXBncmFkZXR5cGVzLlBsYW4sIHZtIG1vZHVsZS5WZXJzaW9uTWFwKSAobW9kdWxlLlZlcnNp
b25NYXAsIGVycm9yKSB7CisJCWZtdC5QcmludGxuKCIiKQorCQlmbXQuUHJpbnRsbigiRHVtbXkg
UXVhc2FyIG1pZ3JhdGlvbiIpCisJCWZtdC5QcmludGxuKCIiKQorCisJCXJldHVybiBtbS5SdW5N
aWdyYXRpb25zKGN0eCwgY29uZmlndXJhdG9yLCB2bSkKKwl9Cit9Cg==
EOS
}

load_patch | git apply

echo "Add the dummy upgrade in the app.go then run a build `make build`"
